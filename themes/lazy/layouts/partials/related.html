{{ $related := .Site.RegularPages.Related . | first 4 }}
{{ with $related }}
<h3>Related Posts</h3>
<ul class="related-posts no-list-style">
  {{ range . }}
  <li class="related-posts__item">
    <a href="{{ .Permalink }}">
    {{ if and (.Params.thumbnail) (hasPrefix .Params.thumbnail "http") }}
      <div class="related-posts__thumbnail">
        <img loading="lazy" src="{{ .Params.thumbnail }}" alt="{{ .Title }}">
      </div>
    {{ else if .Params.thumbnail }}
      <div class="related-posts__thumbnail">
        <img loading="lazy" src="{{ .Permalink }}{{ .Params.thumbnail }}" alt="{{ .Title }}">
      </div>
    {{ else if not .Params.thumbnail }}
      <div class="related-posts__thumbnail no-thumbnail">
      </div>
    {{ end }}
    <div class="related-posts__title">
      {{ .Title }}
    </div>
    </a>
    <time class="publish-time-article" datetime="{{ .PublishDate }}">{{ .PublishDate.Format "January 2006" }}</time>
  </li>
  {{ end }}
</ul>
{{ end }}
